<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPG Line Chart by Season</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .line {
            fill: none;
            stroke-width: 2px;
        }
        .axis-label {
            font-size: 12px;
            fill: #333;
        }
        .title {
            font-size: 16px;
            text-anchor: middle;
            fill: #333;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            border: solid 1px;
            border-radius: 5px;
            padding: 5px;
            opacity: 0;
        }
    </style>
</head>
<body>

<div id="line-chart"></div>

<script>
    // Set up dimensions and margins
    const margin = { top: 50, right: 50, bottom: 50, left: 60 },
          width = 700 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;

    // Append SVG object
    const svg = d3.select("#line-chart")
                  .append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", `translate(${margin.left},${margin.top})`);

    // Create tooltip
    const tooltip = d3.select("body")
                      .append("div")
                      .attr("class", "tooltip");

    // Load data from CSV
    d3.csv("/datasets/per_game_stats.csv").then(data => {
        // Parse data
        data.forEach(d => {
            d.PTS = +d.PTS;   // Convert PPG to a number if needed
            d.Season = +d.Season; // Ensure season is numeric
        });

        // Extract unique players and seasons
        const players = [...new Set(data.map(d => d.Player))];
        const seasons = [...new Set(data.map(d => d.Season))];

        // Define scales
        const x = d3.scaleLinear()
                    .domain(d3.extent(data, d => d.Season))
                    .range([0, width]);

        const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.PTS) + 5])
                    .range([height, 0]);

        // Color scale for each player
        const colorScale = d3.scaleOrdinal()
                             .domain(players)
                             .range(d3.schemeCategory10);

        // Line generator function
        const line = d3.line()
                       .x(d => x(d.Season))
                       .y(d => y(d.PTS));

        // Add X axis
        svg.append("g")
           .attr("transform", `translate(0, ${height})`)
           .call(d3.axisBottom(x).tickFormat(d3.format("d")))
           .attr("class", "axis-label");

        // Add Y axis
        svg.append("g")
           .call(d3.axisLeft(y))
           .attr("class", "axis-label");

        // Group data by player
        const playerData = d3.group(data, d => d.Player);

        // Draw line for each player
        playerData.forEach((values, player) => {
            svg.append("path")
               .datum(values)
               .attr("class", "line")
               .attr("d", line)
               .style("stroke", colorScale(player));
        });

        // Add circles and tooltip interaction for each data point
        svg.selectAll(".dot")
           .data(data)
           .join("circle")
           .attr("cx", d => x(d.Season))
           .attr("cy", d => y(d.PTS))
           .attr("r", 4)
           .style("fill", d => colorScale(d.Player))
           .on("mouseover", (event, d) => {
               tooltip.style("opacity", 1)
                      .html(`Player: ${d.Player}<br>Season: ${d.Season}<br>PPG: ${d.PTS}`)
                      .style("left", `${event.pageX + 5}px`)
                      .style("top", `${event.pageY - 28}px`);
           })
           .on("mousemove", (event) => {
               tooltip.style("left", `${event.pageX + 5}px`)
                      .style("top", `${event.pageY - 28}px`);
           })
           .on("mouseleave", () => {
               tooltip.style("opacity", 0);
           });

        // Add title
        svg.append("text")
           .attr("class", "title")
           .attr("x", width / 2)
           .attr("y", -20)
           .text("Points Per Game (PPG) by Season");

        // Add legend
        const legend = svg.selectAll(".legend")
                          .data(players)
                          .join("g")
                          .attr("transform", (d, i) => `translate(${width - 100},${i * 20})`);

        legend.append("rect")
              .attr("x", 0)
              .attr("y", 0)
              .attr("width", 10)
              .attr("height", 10)
              .style("fill", d => colorScale(d));

        legend.append("text")
              .attr("x", 15)
              .attr("y", 10)
              .style("font-size", "12px")
              .text(d => d);
    });

</script>
</body>
</html>

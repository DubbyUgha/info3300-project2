<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Player Stats Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }

        h1 {
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            margin-bottom: -10px;
            color: #6d53ff;
            padding: 10px;
        }

        h3 {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            background: linear-gradient(90deg, #1f77b4, #ff7f0e, purple);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .line {
            fill: none;
            stroke-width: 2px;
        }

        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            text-anchor: middle;
        }

        .button {
            padding: 10px 20px;
            margin-bottom: 15px;
            margin-right: 10px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: #61abe0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .button:hover, .button.active {
            background-color: blue;
        }

        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
        }

        ul {
            list-style-type: none; 
            padding: 0;
             margin: 0;
        }

        span {
            font-weight: bold;
        }

        #legend {
            margin-top: 20px;
            font-size: 14px; 
            font-family: Arial, sans-serif;
        }
    </style>
</head>

<body>
    <h1>Who's the Best NBA Player Ever? Kobe Bryant, Lebron James, or Michael Jordan?</h1>
    <h3>Basketball Stats By Season</h3>
    <div>
        <button id="jordan-btn" class="button">Michael Jordan</button>
        <button id="kobe-btn" class="button">Kobe Bryant</button>
        <button id="lebron-btn" class="button">LeBron James</button>
    </div>
    <div id="charts">
        <svg id="points" width="800" height="350"></svg>
        <svg id="rebounds" width="800" height="350"></svg>
        <svg id="assists" width="800" height="350"></svg>
        <svg id="salary" width="800" height="350"></svg>
    </div>
    <div id="legend">
        <strong>Legend:</strong>
        <ul >
            <li><span>PTS:</span> Points per game</li>
            <li><span>TRB:</span> Total rebounds per game</li>
            <li><span>AST:</span> Assists per game</li>
            <li><span>Salary:</span> Annual salary (USD)</li>
        </ul>
    </div>

    <script>
        const width = 800;
        const height = 400;
        const margin = { top: 25, right: 30, bottom: 110, left: 70 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;
        //we put chartArea in the CreateChart Function

        // Create a tooltip element
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Load the CSV files
        Promise.all([
            d3.csv("datasets/per_game_stats.csv"),
            d3.csv("datasets/salaries.csv")
        ]).then(([statsData, salariesData]) => {
            const players = ["Michael Jordan", "Kobe Bryant", "Lebron James"];
            const stats = ["PTS", "TRB", "AST", "Salary"];
            const chartIds = ["points", "rebounds", "assists", "salary"]; //this array simplifies selecting the proper id in the forEach loop

            //function to clean and filter data by player
            function filterPlayerData(player) {
                const playerStats = statsData.filter(d => d.Player === player && d.RSorPO === "Regular Season");
                const playerSalaries = salariesData.filter(d => d.Player === player);

                const mergedData = playerStats.map(stat => {
                    const salary = playerSalaries.find(s => s.Season === stat.Season);
                    return {
                        Season: stat.Season,
                        PTS: +stat.PTS,
                        TRB: +stat.TRB,
                        AST: +stat.AST,
                        Salary: salary ? +salary.Salary.replace(/[\$,]/g, '') : 0
                    };
                });

                return mergedData;
            }

            function createChart(player, data) {
                stats.forEach((stat, index) => {
                    const svg = d3.select(`#${chartIds[index]}`);  //This selects a different svg for each stat
                    svg.selectAll("*").remove();

                    const chartArea = svg.append("g").attr("transform", `translate(${margin.left}, ${margin.top})`);

                    const xScale = d3.scaleBand()
                        .domain(data.map(d => d.Season))
                        .range([0, chartWidth])
                        .padding(0.1);

                    const yScale = d3.scaleLinear()
                        .domain([0, d3.max(data, d => d[stat])])
                        .range([chartHeight, 0]);

                    //axes and labels
                    chartArea.append("g")
                        .attr("transform", `translate(0, ${chartHeight})`)
                        .call(d3.axisBottom(xScale))
                        .selectAll("text")
                        .attr("transform", "rotate(-45)") //we rotated the x-axis labels to make it more readable
                        .style("text-anchor", "end");

                    chartArea.append("g").call(d3.axisLeft(yScale));

                    svg.append("text")
                        .attr("x", chartWidth / 2 + margin.left)
                        .attr("y", margin.top / 2)
                        .attr("text-anchor", "middle")
                        .style("font-size", "16px")
                        .style("font-weight", "bold")
                        .text(`${player}'s  ${stat === "Salary" ? "Salary" : stat} per game`);

                    //we found NBA Jersey Colors from teamcolorcodes.com
                    const lineColors = d3.scaleOrdinal()
                        .domain(["Michael Jordan", "Kobe Bryant", "Lebron James"])
                        .range(['#CE1141', '#552583', 'navy']);

                    const dotColors = d3.scaleOrdinal()
                        .domain(["Michael Jordan", "Kobe Bryant", "Lebron James"])
                        .range(["black", "gold", 'red']);
                    
                    const line = d3.line()
                        .x(d => xScale(d.Season) + xScale.bandwidth() / 2)
                        .y(d => yScale(d[stat]));

                    //initates a transition animation on click
                    chartArea.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", lineColors(player))
                        .attr("stroke-width", 2)
                        .attr("d", line)
                        .attr("opacity", 0)
                        .transition()
                        .duration(2000)
                        .attr("opacity", 1);

                    chartArea.selectAll(".dot")
                        .data(data)
                        .join("circle")
                        .attr("cx", d => xScale(d.Season) + xScale.bandwidth() / 2)
                        .attr("cy", d => yScale(d[stat]))
                        .attr("r", 5)
                        .attr("fill", dotColors(player))
                        .attr("opacity", 0)
                        .on("mouseover", (event, d) => {    //to showcase the stat value when hovered over
                            tooltip.transition().duration(200).style("opacity", 1);
                            tooltip.html(`<strong>${stat}:</strong> ${d[stat]}<br><strong>Season:</strong> ${d.Season}`)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 20) + "px");
                        })
                        .on("mouseout", () => {
                            tooltip.transition().duration(200).style("opacity", 0);
                        })
                        .transition()
                        .duration(2000)
                        .attr("opacity", 1);
                });
            }

            d3.select("#jordan-btn").on("click", () => {
                const data = filterPlayerData("Michael Jordan");
                createChart("Michael Jordan", data);
            });

            d3.select("#kobe-btn").on("click", () => {
                const data = filterPlayerData("Kobe Bryant");
                createChart("Kobe Bryant", data);
            });

            d3.select("#lebron-btn").on("click", () => {
                const data = filterPlayerData("Lebron James");
                createChart("Lebron James", data);
            });

            //intial view with Michael Jordan's charts
            let pageLoad = filterPlayerData("Michael Jordan");
            createChart("Michael Jordan", pageLoad);
        });
    </script>
</body>

</html>
